<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LinkedIn Importer - PF-ADS</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    .step { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
    button { background: #0077b5; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
    button:disabled { background: #ccc; }
    .debug { background: #f5f5f5; padding: 15px; border-radius: 4px; margin: 10px 0; font-family: monospace; font-size: 12px; }
    .info { background: #e3f2fd; padding: 15px; border-radius: 4px; margin: 10px 0; }
  </style>
</head>
<body>
  <h1>LinkedIn Importer - PF-ADS</h1>
  
  <div class="info">
    <strong>Note:</strong> To use LinkedIn APIs in production you need:
    <ul>
      <li>An approved LinkedIn Developer app with required products/scopes.</li>
      <li>Business Verification and API access approval for the endpoints you need.</li>
    </ul>\r\n  </div>

    <div class="step">
    <h3>1. Get Authorization Code (basic demo)</h3>
    <button onclick="getAuthCode()">Get Basic Auth Code</button>
    <div>
      <label>Authorization Code:</label>
      <input type="text" id="authCode" style="width: 300px; padding: 5px;" placeholder="Paste code here">
    </div>
  </div><div class="step">
    <h3>2. Exchange for Access Token</h3>
    <button onclick="getAccessToken()" id="tokenBtn">Get Access Token</button>
    <div id="tokenResult" class="debug"></div>
  </div>

  <div class="step">
    <h3>3. Fetch basic profile (demo)</h3>
    <button onclick="getProfile()" id="profileBtn" disabled>Get Basic Profile</button>
    <div id="profileResult" class="debug"></div>
  </div>

  <script>
    let accessToken = '';

    function getAuthCode() {
      const clientId = 'YOUR_LINKEDIN_CLIENT_ID';
      const redirectUri = 'https://www.pf-ads.com/linkedin/callback';
      
      // üîë –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï SCOPES - —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
      const scope = 'openid profile email'; // –ë–∞–∑–æ–≤—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
      
      const state = Math.random().toString(36).substring(7);
      
      const authUrl = `https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${encodeURIComponent(scope)}&state=${state}`;
      
      window.open(authUrl, '_blank');`r`n      alert('After authorization, copy the code parameter from the redirected URL and paste it back here.');
    }

    async function getAccessToken() {
      const code = document.getElementById('authCode').value.trim();
      if (!code) {
        alert("Please paste authorization code");
        return;
      }

      const btn = document.getElementById('tokenBtn');
      btn.disabled = true;
      btn.textContent = 'Getting token...';

      try {
        const response = await fetch('/linkedin-posts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'get_token',
            code: code
          })
        });

        const result = await response.json();
        document.getElementById('tokenResult').innerHTML = JSON.stringify(result, null, 2);
        
        if (result.success) {
          accessToken = result.access_token;
          document.getElementById('profileBtn').disabled = false;
        }
      } catch (error) {
        document.getElementById('tokenResult').innerHTML = 'Error: ' + error.message;
      } finally {
        btn.disabled = false;
        btn.textContent = 'Get Access Token';
      }
    }

    async function getProfile() {
      if (!accessToken) {
        alert("Please paste authorization code");
        return;
      }

      const btn = document.getElementById('profileBtn');
      btn.disabled = true;
      btn.textContent = 'Loading profile...';

      try {
        // –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ - –ø–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
        const response = await fetch('https://api.linkedin.com/v2/me', {
          headers: {
            'Authorization': `Bearer ${accessToken}`,
          },
        });

        const result = await response.json();
        document.getElementById('profileResult').innerHTML = JSON.stringify(result, null, 2);
      } catch (error) {
        document.getElementById('profileResult').innerHTML = 'Error: ' + error.message;
      } finally {
        btn.disabled = false;
        btn.textContent = 'Get Basic Profile';
      }
    }
  </script>
</body>
</html>