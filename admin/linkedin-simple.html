<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LinkedIn Importer - PF-ADS</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    .step { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
    button { background: #0077b5; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
    button:disabled { background: #ccc; }
    .debug { background: #f5f5f5; padding: 15px; border-radius: 4px; margin: 10px 0; font-family: monospace; font-size: 12px; }
    .info { background: #e3f2fd; padding: 15px; border-radius: 4px; margin: 10px 0; }
  </style>
</head>
<body>
  <h1>LinkedIn Importer - PF-ADS</h1>
  
  <div class="info">
    <strong>–í–∞–∂–Ω–æ:</strong> –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ—Å—Ç–∞–º —á–µ—Ä–µ–∑ LinkedIn API –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
    <ul>
      <li>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –∏ –æ–¥–æ–±—Ä–µ–Ω–æ LinkedIn</li>
      <li>–¢—Ä–µ–±—É–µ—Ç—Å—è Business Verification –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API –ø–æ—Å—Ç–æ–≤</li>
    </ul>
  </div>

  <div class="step">
    <h3>1. –ü–æ–ª—É—á–∏—Ç—å Authorization Code (–ë–∞–∑–æ–≤—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è)</h3>
    <button onclick="getAuthCode()">Get Basic Auth Code</button>
    <div>
      <label>Authorization Code:</label>
      <input type="text" id="authCode" style="width: 300px; padding: 5px;" placeholder="Paste code here">
    </div>
  </div>

  <div class="step">
    <h3>2. –ü–æ–ª—É—á–∏—Ç—å Access Token</h3>
    <button onclick="getAccessToken()" id="tokenBtn">Get Access Token</button>
    <div id="tokenResult" class="debug"></div>
  </div>

  <div class="step">
    <h3>3. –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞</h3>
    <button onclick="getProfile()" id="profileBtn" disabled>Get Basic Profile</button>
    <div id="profileResult" class="debug"></div>
  </div>

  <script>
    let accessToken = '';

    function getAuthCode() {
      const clientId = '77c7i4jjqp5e8g';
      const redirectUri = 'https://www.pf-ads.com/linkedin/callback';
      
      // üîë –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï SCOPES - —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
      const scope = 'openid profile email'; // –ë–∞–∑–æ–≤—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
      
      const state = Math.random().toString(36).substring(7);
      
      const authUrl = `https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${encodeURIComponent(scope)}&state=${state}`;
      
      window.open(authUrl, '_blank');
      
      alert('–ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ code –∏–∑ URL –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ –≤—ã—à–µ.');
    }

    async function getAccessToken() {
      const code = document.getElementById('authCode').value.trim();
      if (!code) {
        alert('–í–≤–µ–¥–∏—Ç–µ authorization code');
        return;
      }

      const btn = document.getElementById('tokenBtn');
      btn.disabled = true;
      btn.textContent = 'Getting token...';

      try {
        const response = await fetch('/functions/linkedin-posts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'get_token',
            code: code
          })
        });

        const result = await response.json();
        document.getElementById('tokenResult').innerHTML = JSON.stringify(result, null, 2);
        
        if (result.success) {
          accessToken = result.access_token;
          document.getElementById('profileBtn').disabled = false;
        }
      } catch (error) {
        document.getElementById('tokenResult').innerHTML = 'Error: ' + error.message;
      } finally {
        btn.disabled = false;
        btn.textContent = 'Get Access Token';
      }
    }

    async function getProfile() {
      if (!accessToken) {
        alert('No access token');
        return;
      }

      const btn = document.getElementById('profileBtn');
      btn.disabled = true;
      btn.textContent = 'Loading profile...';

      try {
        // –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ - –ø–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
        const response = await fetch('https://api.linkedin.com/v2/me', {
          headers: {
            'Authorization': `Bearer ${accessToken}`,
          },
        });

        const result = await response.json();
        document.getElementById('profileResult').innerHTML = JSON.stringify(result, null, 2);
      } catch (error) {
        document.getElementById('profileResult').innerHTML = 'Error: ' + error.message;
      } finally {
        btn.disabled = false;
        btn.textContent = 'Get Basic Profile';
      }
    }
  </script>
</body>
</html>
