<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Панель управления PF-ADS</title>
  
  <!-- Загрузка Decap CMS с резервными источниками -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  
  <!-- Резервный источник -->
  <script>
    // Если основной скрипт не загрузился, пробуем альтернативный
    if (typeof CMS === 'undefined') {
      console.log('Основной скрипт не загружен, пробуем альтернативный...');
      document.write('<script src="https://cdn.jsdelivr.net/npm/decap-cms@3.8.4/dist/decap-cms.js"><\/script>');
    }
  </script>
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }
    
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }
    
    .error {
      background: #ffebee;
      color: #c62828;
      padding: 20px;
      border-radius: 5px;
      margin: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="cms-loading" class="loading">
    <h2>Загрузка панели управления...</h2>
    <p>Пожалуйста, подождите</p>
  </div>

  <div id="cms-error" class="error" style="display: none;">
    <h3>Ошибка загрузки</h3>
    <p>Не удалось загрузить редактор. Пожалуйста, проверьте:</p>
    <ul>
      <li>Подключение к интернету</li>
      <li>Блокировку скриптов браузером</li>
      <li>Настройки безопасности</li>
    </ul>
    <button onclick="window.location.reload()">Перезагрузить</button>
  </div>

  <script>
    // Ждем полной загрузки страницы
    window.addEventListener('load', function() {
      setTimeout(function() {
        // Проверяем, загрузился ли CMS
        if (typeof CMS === 'undefined') {
          console.error('CMS не загружен после ожидания');
          document.getElementById('cms-loading').style.display = 'none';
          document.getElementById('cms-error').style.display = 'block';
        } else {
          // Инициализация CMS
          try {
            console.log('CMS загружен, инициализируем...');
            
            // Скрываем loading
            document.getElementById('cms-loading').style.display = 'none';
            
            // Русская локаль
            CMS.registerLocale('ru', {
              app: {
                header: {
                  content: 'Контент',
                  media: 'Медиа',
                  app: 'Приложение'
                },
                buttons: {
                  save: 'Сохранить',
                  saving: 'Сохранение...',
                  delete: 'Удалить',
                  uploading: 'Загрузка...'
                }
              }
            });

            // Инициализация
            CMS.init({
              config: {
                locale: 'ru'
              }
            });
            
            console.log('CMS успешно инициализирован');
            
          } catch (error) {
            console.error('Ошибка при инициализации CMS:', error);
            document.getElementById('cms-loading').style.display = 'none';
            document.getElementById('cms-error').style.display = 'block';
          }
        }
      }, 3000); // Даем 3 секунды на загрузку скрипта
    });

    // Альтернативная проверка через интервалы
    var checkCmsLoaded = setInterval(function() {
      if (typeof CMS !== 'undefined') {
        clearInterval(checkCmsLoaded);
        console.log('CMS обнаружен, инициализируем...');
        
        document.getElementById('cms-loading').style.display = 'none';
        
        try {
          CMS.init({
            config: {
              locale: 'ru'
            }
          });
        } catch (e) {
          console.error('Ошибка инициализации:', e);
        }
      }
    }, 500);
    
    // Останавливаем проверку через 10 секунд
    setTimeout(function() {
      clearInterval(checkCmsLoaded);
    }, 10000);
  </script>
</body>
</html>
